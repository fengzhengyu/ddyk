$(function(){var a=location.href.split("?")[1];if(a)for(var t=a.split("&"),e=0;e<t.length;e++){var n=t[e].split("=");if("channel"==n[0])l=n[1];else if("area"==n[0])s=n[1];else if("page"==n[0])i=n[1]}else var l="",s="",i=1;var o=$.cookie("userToken"),c=getQueryString("key"),p=DD_api.buyIndex,r={num:20,page:i},h=getAjax(p,r),d=h.dataChannel,u=h.dataArea,f=h.dataBuy,y=h.buyTotal,g=DD_api.selectBuy,v={channelId:l,areaId:s,buyName:c,num:20,page:i},m=getAjax(g,v),b=m.dataBuy,k=m.buyTotal,w="",_="",B="",W=$("#agent_container_channel"),x=$("#agent_container_area"),A=$("#table tbody"),D=$(".totals"),I=$("#agent_container_screen1"),C=$("#agent_container_screen2"),P=$("#pageValue"),T=$("#pageGo"),j=$("#page"),N=$("#keyWord");if(h){for(e=0;e<d.length;e++)w+='<span><label for="channel'+e+'"><input type="radio" name="c_radio" value="'+d[e].channelId+'" id="channel'+e+'"/>'+d[e].channelName+"</label></span>";W.html(w);for(var q=0;q<u.length;q++)_+='<span><label for="area'+q+'"><input type="radio" name="a_radio" value="'+u[q].id+'" id="area'+q+'"/>'+u[q].province+"</label></span>";if(x.html(_),"success"==h.flag){for(var G=0;G<f.length;G++)B+="<tr><td>"+f[G].buyName+"</td><td>"+f[G].buyArea+"</td><td>"+f[G].buyChannel+"</td><td>"+f[G].buyPerson+'</td><td><a href="javascript:;" class="look" id="'+f[G].buyId+'">查看</a></td></tr>';A.html(B),D.html(y)}else A.html("暂无数据！");var Q=W.find("input"),F=x.find("input"),O=$("#clear_all");if(Q.click(function(){if(1==$(this).prop("checked")){var a=$(this).val();window.location.href="WantBuy.html?channel="+a+"&area="+s+"&page="}}),""!=l)if(Q.eq(l-1).attr("checked",!0),O.show(),I.html('<span class="close">'+Q.eq(l-1).parent().text()+"</span>"),"success"==m.flag){for(var M="",e=0;e<b.length;e++)M+="<tr><td>"+b[e].buyName+"</td><td>"+b[e].buyArea+"</td><td>"+b[e].buyChannel+"</td><td>"+b[e].buyPerson+'</td><td><a href="javascript:;" class="look" id="'+b[e].buyId+'">查看</a></td></tr>';A.html(M),D.html(k)}else window.location.href="WantBuy.html?channel=&area=&page=",alert("暂无数据");if(F.click(function(){if(1==$(this).prop("checked")){var a=$(this).val();window.location.href="WantBuy.html?channel=&area="+a+"&page="}}),""!=s)if(F.eq(s-1).attr("checked",!0),O.show(),C.html('<span class="close">'+Q.eq(l-1).parent().text()+"</span>"),"success"==m.flag){for(var S="",e=0;e<b.length;e++)S+="<tr><td>"+b[e].buyName+"</td><td>"+b[e].buyArea+"</td><td>"+b[e].buyChannel+"</td><td>"+b[e].buyPerson+'</td><td><a href="javascript:;" class="look" id="'+b[e].buyId+'">查看</a></td></tr>';A.html(S),D.html(k)}else window.location.href="WantBuy.html?channel=&area=&page=",alert("暂无数据");if(null!=c)if("success"==m.flag){for(var V="",e=0;e<b.length;e++)V+="<tr><td>"+b[e].buyName+"</td><td>"+b[e].buyArea+"</td><td>"+b[e].buyChannel+"</td><td>"+b[e].buyPerson+'</td><td><a href="javascript:;" class="look" id="'+b[e].buyId+'">查看</a></td></tr>';A.html(V),D.html(k)}else window.location.href="WantBuy.html",alert("暂无数据");I.on("click",".close",function(){Q.each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).remove(),window.location.href="WantBuy.html?channel=&area="+s+"&page="}),C.on("click",".close",function(){F.each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).remove(),window.location.href="WantBuy.html?channel="+l+"&area=&page="}),O.click(function(){$('.agent_container input[type="radio"]').each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).siblings("div").children().remove(),O.hide(),window.location.href="WantBuy.html"}),N.click(function(){var a=$("#wordText").val(),t=/^[0-9]*$/;""==a||t.test(a)?alert("关键字不能为空或输入有误！"):window.location.href="WantBuy.html?channel="+l+"&area="+s+"&key="+a+"&page="});var z={go:function(a){window.location.href=c?"WantBuy.html?channel="+l+"&area="+s+"&key="+c+"&page="+a:"WantBuy.html?channel="+l+"&area="+s+"&page="+a}};""==l&&""==s?j.initPage(y,i,z.go):j.initPage(k,i,z.go),T.click(function(){var a=P.val(),t={go:function(a){window.location.href=c?"WantBuy.html?channel="+l+"&area="+s+"&key="+c+"&page="+a:"WantBuy.html?channel="+l+"&area="+s+"&page="+a}};j.initPage(k,i,t.go(a))}),A.on("click",".look",function(a){if(o){var t=$(this).attr("id"),e=DD_api.buyFindAuth,n={userToken:o,buyId:t},l=getAjax(e,n),s=l.data.buyCount,i=l.data.consumeGold,c=$(".agentPopup");popup(c),a.stopPropagation();c.html('<div class="popupDiv"><div class="text">温馨提示：</div><div class="content" id="Auth"></div><div class="btn"><span class="btn_no">取消</span><span class="btn_yes">确定</span></div></div><div class="popupDiv2"></div>');var p=$("#Auth"),r=$(".popupDiv"),h=$(".popupDiv2");"success"==l.flag?(p.html(l.info),c.on("click",".btn_yes",function(){var a=$.cookie("goldTotal"),e=parseInt(a)-parseInt(i);$.cookie("goldTotal",e,{expires:1,path:"/"}),r.remove(),h.show();var n=DD_api.buyFindInfo,l={userToken:o,buyId:t,buyCount:s,consumeGold:i},c=getAjax(n,l).dataBuy,p='<h2>求购详情：<i class="lookClose"></i></h2><p><span class="title">求购品种：</span><span class="content">'+c.buyName+'</span></p><p><span class="title">求购渠道：</span><span class="content">'+c.buyChannel+'</span></p><p><span class="title">求购区域：</span><span class="content">'+c.buyArea+'</span></p><p><span class="title">求购留言：</span><span class="content">'+c.buyMessage+'</span></p><p><span class="title">联系人：</span><span class="content">'+c.buyPerson+'</span></p><p><span class="title">联系手机：</span><span class="content">'+c.buyPhone+'</span></p><p><span class="title">联系QQ：</span><span class="content">'+c.qq+'</span></p><p><span class="title">联系微信：</span><span class="content">'+c.weChat+'</span></p><p><span class="title">求购时间：</span><span class="content">'+c.publishTime+"</span></p><div></div></div>";h.html(p)}),h.on("click",".lookClose",function(){$(this).parents(".popupDiv2").children().remove(),c.fadeOut()})):p.html(l.info),c.on("click",".btn_no",function(){c.html(""),c.fadeOut()})}else alert("请登录")})}else $(".agent_main").html('<div style="height: 300px;line-height: 300px;text-align: center;">暂无数据，请稍后再来！</div>')});