$(function(){var s=$.cookie("userToken");if(s){var t=window.location.search,e=t.substring(t.lastIndexOf("=")+1,t.length),a={userToken:s,page:e,num:20},i=DD_api.managementInvestment,o=getAjax(i,a),n=o.data,d=o.total,c=$(".page_total"),l=$("#gl_table tbody"),p=$("#page"),r=$(".zs_popup"),m="";if("success"==o.flag){for(var f=0;f<n.length;f++)m+=' <tr><td class="cp_name"><a href="merchantsDetails.html?id='+n[f].id+"&parentId="+n[f].parentId+"&sunName="+n[f].sunName+'" target="_blank">'+n[f].goodsName+'</a></td><td class="cp_kind">'+n[f].parentsName+'</td><td class="cp_class">'+n[f].sunName+'</td><td class="cp_date">'+n[f].passTime+'</td><td class="cp_state1">'+n[f].checkType+'</td><td  class="cp_operation"><a href="javascript:;" class="zs_stick" data-goodsId="'+n[f].id+'">置顶</a><a href="javascript:;" class="zs_refresh" data-id="'+n[f].id+'" data-status="'+n[f].adStatus+'">申请广告位</a><a href="ManagementInvestment2.html?id='+n[f].id+'" class="zs_modify">修改</a><a href="javascript:;" class="zs_delete" id="'+n[f].id+'">删除</a></td></tr>';l.html(m),c.html(d),$("#gl_table .cp_state1").each(function(){var s=$(this).text();"已审核"==s?($(this).css("color","#20c300"),$(this).next().children(".zs_modify").hide()):"未通过"==s?($(this).css("color","#ff0000"),$(this).next().children(".zs_modify").show(),$(this).next().children(".zs_refresh").hide(),$(this).next().children(".zs_stick").hide()):($(this).css("color","#ff8400"),$(this).next().children(".zs_modify").show(),$(this).next().children(".zs_refresh").hide(),$(this).next().children(".zs_stick").hide())});var h=$("#gl_table td");h.find(".zs_refresh").each(function(){"已申请"==$(this).attr("data-status")&&($(this).text("已申请广告位"),$(this).css("color","#999"),$(this).click(function(){return!1}))}),h.on("click",".zs_refresh",function(t){var e=$(this);r.html('<div class="popup_box"><div class="top">申请广告位信息<span class="zs_popup_close"></span></div><div class="zs_middle"><div class="commodity"><span>申请产品：</span> <p class="commodityName"></p></div><div class="commodity time"><span>申请周期：</span><p class="commodityTime"></p></div><div class="commodity type"><span>广告类型：</span><p class="commodityType"></p></div> <div class="commodity info">此广告位为付费推广服务，需在您购买之后方予开通。<br/>请您致电：010-59492286 / 13521918319</div></div><div class="bottom"><span class="btn2 zs_popup_close2">取消</span><span class="btn1 zs_confirm" id="advertising_affirm">确认</span></div></div>'),popup(r),t.stopPropagation(),e.css("color","red");var a=$(this).attr("data-id"),i=$(this).parent().siblings(".cp_name").html(),o=$("#advertising_affirm");if($(".commodityName").html(i),s){for(var n={userToken:s},d=DD_api.advertisingTypeDate,c=getAjax(d,n),l=c.timeData,p=c.asTypeData,m="",f="",h=$(".commodityTime"),u=$(".commodityType"),v=0;v<l.length;v++)m+='<label for="dTime'+v+'"><input type="radio" id="dTime'+v+'" value="'+l[v].timeId+'" name="dTime"/>'+l[v].timeName+"</label>";h.html(m);for(v=0;v<p.length;v++)f+='<label for="dType'+v+'"><input type="radio" id="dType'+v+'" value="'+p[v].adTypeId+'" name="dType"/>'+p[v].adName+"</label>";u.html(f)}o.click(function(){var t=$('.commodityTime input[name="dTime"]:checked').val(),i=$('.commodityType input[name="dType"]:checked').val(),o={userToken:s,goodsId:a,timeId:t,adTypeId:i},n=DD_api.submitAdvertisement,d=getAjax(n,o);"success"==d.flag?(alert(d.info),r.fadeOut(),$(this).parent().parent().remove(),e.css("color","#999"),e.click(function(){return!1})):alert(d.info)})}),h.on("click",".zs_stick",function(t){var e=$(this).attr("data-goodsId");popup(r);var a='<div class="popup_box"><div class="top">置顶<span class="zs_popup_close"></span></div><div class="zs_middle"> <div class="zs_stick">什么是置顶？<br/>是使您当前提交的置顶产品，在招商栏目中所对应类别列表中置顶排名的功能。<br/>只支持单个产品的置顶功能。<br/></div><div class="zs_stickInfo"></div></div><div class="bottom"><span class="btn2 zs_popup_close2">取消</span><span class="btn1 zs_confirm" id="stick_affirm" data-id="'+e+'">确认</span></div></div>';r.html(a),t.stopPropagation();var i=DD_api.investmentGoldSure,o={userToken:s,goodsId:e},n=getAjax(i,o);"success"==n.flag?(r.find(".zs_stickInfo").html(n.info),consumeGold=n.data.consumeGold):r.find(".zs_stickInfo").html(n.info)}),h.on("click",".zs_delete",function(){var t=$(this),e=$(this).attr("id"),a=DD_api.deleteSureGoods,i={userToken:s,goodsId:e},o=getAjax(a,i);"success"==o.flag?(t.parent().parent().remove(),alert(o.info)):alert(o.info)})}else alert(o.info);r.on("click","#stick_affirm",function(){var t=DD_api.investmentTop,e=$(this).attr("data-id"),a={userToken:s,goodsId:e,consumeGold:consumeGold},i=getAjax(t,a);if("success"==i.flag){alert(i.info),r.fadeOut(),$(this).parents(".popup_box").remove();var o=$.cookie("goldTotal"),n=parseInt(o)-parseInt(consumeGold);$.cookie("goldTotal",n,{expires:1,path:"/"})}else alert(i.info)});var u={go:function(s){window.location.href="ManagementInvestment.html?page="+s}};p.initPage(d,e,u.go),$(document).on("click",".zs_popup_close",function(){$(this).parent().parent().remove(),r.fadeOut()}),$(document).on("click",".zs_popup_close2",function(){$(this).parent().parent().remove(),r.fadeOut()})}});