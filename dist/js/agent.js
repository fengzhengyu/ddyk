$(function(){var e=location.href.split("?")[1];if(e)for(var t=e.split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if("channel"==n[0])o=n[1];else if("area"==n[0])d=n[1];else if("page"==n[0])i=n[1]}else var o="",d="",i=1;var c=getQueryString("key"),l=DD_api.agentData,r={num:20,page:i},h=getAjax(l,r),s=h.dataChannel,p=h.dataArea,g=h.dataAgent,u=h.agentTotal,f=DD_api.selectAgent,m={num:20,page:i,channelId:o,areaId:d,nowType:c},k=getAjax(f,m),v=k.dataAgent,w=k.agentTotal,y="",b="",x="",D=$("#agent_container_channel"),_=$("#agent_container_area"),A=$("#table tbody"),T=$(".totals"),N=$("#agent_container_screen1"),B=$("#agent_container_screen2"),I=$("#pageValue"),P=$("#pageGo"),C=$("#page"),j=$("#keyWord"),q=$("#download");if(h){for(a=0;a<s.length;a++)y+='<span><label for="channel'+a+'"><input type="radio" name="c_radio" value="'+s[a].channelId+'" id="channel'+a+'"/>'+s[a].channelName+"</label></span>";D.append(y);for(var G=0;G<p.length;G++)b+='<span><label for="area'+G+'"><input type="radio" name="a_radio" value="'+p[G].id+'" id="area'+G+'"/>'+p[G].province+"</label></span>";_.append(b);for(var O=0;O<g.length;O++)x+='<tr><td><input type="checkbox" name="checkbox" value="'+g[O].agentId+'"/></td><td>'+g[O].agentAddress+"</td><td>"+g[O].agentName+"</td><td>"+g[O].agentType+"</td><td>"+g[O].agentChannel+"</td><td>"+g[O].nowNum+"</td><td>"+g[O].nowType+"</td><td>"+g[O].agentArea+"</td><td>"+g[O].relationPersonName+"</td></tr>";A.html(x),T.html(u);var R=D.find("input"),S=_.find("input"),Q=$("#clear_all"),V=$("#message_all");if(R.on("click",function(){if(1==$(this).prop("checked")){var e=$(this).attr("value");window.location.href="agentDataBase.html?channel="+e+"&area="+d+"&page="}}),S.on("click",function(){if(1==$(this).prop("checked")){var e=$(this).attr("value");window.location.href="agentDataBase.html?channel="+o+"&area="+e+"&page="}}),""!=o)if(R.eq(o-1).attr("checked",!0),Q.show(),N.html('<span class="close">'+R.eq(o-1).parent().text()+"</span>"),"success"==k.flag){for(var W="",a=0;a<v.length;a++)W+='<tr><td><input type="checkbox" name="checkbox" value="'+v[a].agentId+'"/></td><td>'+v[a].agentAddress+"</td><td>"+v[a].relationPersonName+"</td><td>"+v[a].agentType+"</td><td>"+v[a].agentChannel+"</td><td>"+v[a].nowNum+"</td><td>"+v[a].nowType+"</td><td>"+v[a].agentArea+"</td><td>"+v[a].relationPersonName+"</td></tr>";A.html(W),T.html(w)}else window.location.href="agentDataBase.html",alert("暂无数据");if(""!=d)if(S.eq(d-1).attr("checked",!0),Q.show(),B.html('<span class="close">'+S.eq(d-1).parent().text()+"</span>"),k.flag="success"){for(var z="",a=0;a<v.length;a++)z+=' <tr><td><input type="checkbox" name="checkbox" value="'+v[a].agentId+'"/></td><td>'+v[a].agentAddress+"</td><td>"+v[a].relationPersonName+"</td><td>"+v[a].agentType+"</td><td>"+v[a].agentChannel+"</td><td>"+v[a].nowNum+"</td><td>"+v[a].nowType+"</td><td>"+v[a].agentArea+"</td><td>"+v[a].relationPersonName+"</td></tr>";A.html(z),T.html(w)}else B.remove(),window.location.href="agentDataBase.html",alert("暂无数据");if(null!=c){for(var E="",a=0;a<v.length;a++)E+=' <tr><td><input type="checkbox" name="checkbox" value="'+v[a].agentId+'"/></td><td>'+v[a].agentAddress+"</td><td>"+v[a].relationPersonName+"</td><td>"+v[a].agentType+"</td><td>"+v[a].agentChannel+"</td><td>"+v[a].nowNum+"</td><td>"+v[a].nowType+"</td><td>"+v[a].agentArea+"</td><td>"+v[a].relationPersonName+"</td></tr>";A.html(E),T.html(w)}N.on("click",".close",function(){R.each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).remove(),window.location.href="agentDataBase.html?channel=&area="+d+"&page="}),B.on("click",".close",function(){S.each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).remove(),window.location.href="agentDataBase.html?channel="+o+"&area=&page="}),Q.click(function(){$('.agent_container input[type="radio"]').each(function(){$(this).prop("checked")&&$(this).prop("checked",!1)}),$(this).siblings("div").children().remove(),Q.hide(),window.location.href="agentDataBase.html"}),V.click(function(){$('input[name="checkbox"]').prop("checked",this.checked)});var F=$('input[name="checkbox"]');F.click(function(){V.attr("checked",F.length==$("input[name='checkbox']:checked").length)}),j.click(function(){var e=$("#wordText").val(),t=/^[0-9]*$/;""==e||t.test(e)?alert("关键字不能为空或输入有误！"):window.location.href="agentDataBase.html?channel="+o+"&area="+d+"&key="+e+"&page="});var H={go:function(e){window.location.href=c?"agentDataBase.html?channel="+o+"&area="+d+"&key="+c+"&page="+e:"agentDataBase.html?channel="+o+"&area="+d+"&page="+e}};""==o&&""==d?C.initPage(u,i,H.go):C.initPage(w,i,H.go),P.click(function(){var e=I.val(),t={go:function(e){window.location.href=c?"agentDataBase.html?channel="+o+"&area="+d+"&key="+c+"&page="+e:"agentDataBase.html?channel="+o+"&area="+d+"&page="+e}};C.initPage(w,i,t.go(e))}),q.click(function(e){var t=$.cookie("userToken"),a=$(".agentPopup");if(t){popup(a),e.stopPropagation();var n=getSelected($('input[name="checkbox"]:checked')),o=n.join(","),d=DD_api.downloadAuth,i={userToken:t,agentId:o},c=getAjax(d,i),l="";if(l='<div class="popupDiv"><div class="text">温馨提示：</div><div class="content" id="Auth"></div><div class="btn"><span class="btn_no">取消</span><span class="btn_yes">确定</span></div></div>',a.html(l),"success"==c.flag){$("#Auth").html(c.info);var r=c.data.agentCount,h=c.data.consumeGold,s=c.numRemainder;r<s?a.find(".btn_yes").click(function(){return alert("请勾选正确的条数"),!1}):a.find(".btn_yes").click(function(){var e=DD_api.agentDownload,n=$.cookie("goldTotal"),d=parseInt(n)-parseInt(h);$.cookie("goldTotal",d,{expires:1,path:"/"}),s>0?(window.location.href=e+"/userToken/"+t+"/agentId/"+o+"/agentCount/"+r+"/consumeGold/"+h+"/numRemainder/"+s,a.fadeOut()):(window.location.href=e+"/userToken/"+t+"/agentId/"+o+"/agentCount/"+r+"/consumeGold/"+h+"/numRemainder/0",a.fadeOut())})}else $("#Auth").html(c.info);a.find(".btn_no").click(function(){a.fadeOut()})}else alert("请登录")})}else $(".agent_main").html('<div style="height: 300px;line-height: 300px;text-align: center;">暂无数据，请稍后再来！</div>')});