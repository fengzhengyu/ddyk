$(function(){var y=$(".province"),D=$(".city"),_=$(".country"),e=$("#updatefile1"),a=$("#updatefile2"),k=$("#company"),b=$("#shopName"),x=$("#person"),w=$("#phone"),I=$("#detail"),T=$("#relationMobile"),j=$("#relationEmail"),P=$("#QQ"),Q=$("#weChat"),A=$.cookie("userToken"),t=DD_api.enterpriseTypeCategory,n=DD_api.editMemberInfo,o={userToken:A},i=getAjax(t,o),l=getAjax(n,o),p=i.companyData,s=i.companyManageData,c="",r="",d=$(".enterprise_type"),h=$(".top_ten_kind"),u=$(".information_btn .btn"),m=l.data,v=m.companyType,g=m.address,f=m.companyManageType,C=m.LicensePhoto,M=m.QualificationPhoto,N=m.company,S=m.shopName,E=m.relationPerson,F=m.sex,J=m.relationPhone,L=m.addressDetail,O=m.relationMobile,q=m.relationEmail,z=m.QQ,B=m.weChat,G=DD_api.provinceData,H=getAjax(G).data,K="";y.html('<option value="">选择省（市）</option>'),D.html('<option value="">选择市（区）</option>'),_.html('<option value="">选择区（县）</option>');for(var R=0;R<p.length;R++)c+='<label for="companyId'+R+'"><input type="checkbox"  id="companyId'+R+'" value="'+p[R].companyId+'"/>'+p[R].companyName+"</label>";d.append(c);for(R=0;R<s.length;R++)r+='<label for="manageId'+R+'"><input type="checkbox" id="manageId'+R+'" value="'+s[R].manageId+'"/>'+s[R].manageTypeName+"</label>";h.append(r);for(R=0;R<H.length;R++)K+='<option value="'+H[R].id+'" name="address">'+H[R].province+"</option>";if(y.append(K),y.change(function(){var e={pid:$(this).children("option:selected").val()},a=DD_api.cityData,t=getAjax(a,e),n=t.data;if("success"==t.flag){for(var o="",i=0;i<n.length;i++)o+='<option value="'+n[i].id+'" name="address">'+n[i].city+"</option>";D.html(o);var l={cityId:D.children("option:selected").val()},p=DD_api.countryData,s=getAjax(p,l),c=s.data;if("success"==s.flag){var r="";for(i=0;i<c.length;i++)r+='<option value="'+c[i].id+'" name="address">'+c[i].country+"</option>";_.html(r)}}}),D.change(function(){for(var e={cityId:$(this).children("option:selected").val()},a=DD_api.countryData,t=getAjax(a,e).data,n="",o=0;o<t.length;o++)n+='<option value="'+t[o].id+'" name="address">'+t[o].country+"</option>";_.html(n)}),d.on("click","label",function(){$(".enterprise_type label").each(function(){$(this).click(function(){$(this).toggleClass("on")})})}),h.on("click","label",function(){$(".top_ten_kind label").each(function(){$(this).click(function(){$(this).toggleClass("on")})})}),v){0==z&&(z=""),0==O&&(O=""),C&&e.siblings(".show-img").show().attr("data-img",C),M&&a.siblings(".show-img").show().attr("data-img",M),$(".show-img").click(function(e){var a=$(this).attr("data-img");popup($("#imgPopup"));var t=new Image;t.src=a,$("#imgPopup").html(t),e.stopPropagation()}),$(document).click(function(){$("#imgPopup").hide()}),k.val(N),b.val(S),x.val(E),w.val(J),I.val(L),T.val(O),j.val(q),P.val(z),Q.val(B);var U=v.split(","),V=f.split(","),W=g.split(","),X=W[0],Y=W[1],Z=W[2],ee=DD_api.cityData,ae=getAjax(ee,{pid:X}).data,te="",ne=DD_api.countryData,oe=getAjax(ne,{cityId:Y}).data,ie="";for(R=0;R<H.length;R++)H[R].id==X&&(K+='<option value="'+H[R].id+'" name="address" selected>'+H[R].province+"</option>");y.html(K);for(R=0;R<ae.length;R++)ae[R].id==Y&&(te+='<option value="'+ae[R].id+'" name="address" selected>'+ae[R].city+"</option>"),te+='<option value="'+ae[R].id+'" name="address">'+ae[R].city+"</option>";D.html(te);for(R=0;R<oe.length;R++)oe[R].id==Z&&(ie+='<option value="'+oe[R].id+'" name="address" selected>'+oe[R].country+"</option>"),ie+='<option value="'+oe[R].id+'" name="address">'+oe[R].country+"</option>";_.html(ie),$('input[name="sex"]').each(function(){$(this).val()==F&&$(this).prop("checked",!0)}),$(".enterprise_type input").each(function(){for(var e=0;e<U.length;e++)$(this).val()==U[e]&&($(this).prop("checked",!0),$(this).parent().addClass("on"))}),$(".top_ten_kind input").each(function(){for(var e=0;e<V.length;e++)$(this).val()==V[e]&&($(this).prop("checked",!0),$(this).parent().addClass("on"))})}u.click(function(){var e=getSelected($(".enterprise_type input")),a=getSelected($(".top_ten_kind input")),t=y.children("option:selected").val(),n=D.children("option:selected").val(),o=_.children("option:selected").val(),i=$('input[name="sex"]:checked').val(),l=k.val(),p=b.val(),s=x.val(),c=w.val(),r=I.val(),d=T.val(),h=j.val(),u=P.val(),m=Q.val(),v=[];if(v.push(t),v.push(n),v.push(o),""==d||/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/.test(d))if(""==h||/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(h))if(""==u||/[1-9][0-9]{4,}/.test(u)){var g={userToken:A,companyType:e,address:v,companyManageType:a,company:l,shopName:p,relationPerson:s,relationPhone:c,addressDetail:r,relationMobile:d,relationEmail:h,QQ:u,weChat:m,sex:i},f={url:DD_api.insertMemberInfo,type:"post",data:g,dataType:"text",contentType:"application/json;charset=utf-8",success:function(e){var a=JSON.parse(e);a.flag,alert(a.info)},error:function(e,a,t){}};$("#saveForm").ajaxSubmit(f)}else alert("QQ格式不对！");else alert("邮箱格式不对！");else alert("电话格式不对！")})});