$(function(){var l=$.cookie("userToken");if(l){var n=$(".modify_popup"),t=$(".popup_box"),s=$.cookie("userName"),a=$.cookie("userPhone"),e=$.cookie("userEmail"),o=$("#niceName"),p=$("#nickname"),i=$("#cPhone"),c=$("#emailName"),d=$("#setEmail"),u=$(".modify1"),m=$(".modify2"),r=$(".modify3"),f=$(".modify4");if(logout=$(".logout"),u.click(function(s){popup(n),s.stopPropagation();t.html('<div class="top">修改用户昵称<span class="popup_close"></span></div><div class="middle"><p class="modifyName">新昵称：<input type="text" class="memberName"/></p></div><div class="bottom"><span class="btn2 popup_close2">取消</span><span class="btn1" id="nameBtn">确认</span></div>')}),m.click(function(s){popup(n),s.stopPropagation();t.html(' <div class="top">修改登陆密码<span class="popup_close popup_close2"></span></div><div class="middle middle2"><p class="modifyPass"><span>当前登录密码：</span><input type="password" class="memberPass" id="pass"/></p><p class="modifyPass"><span>新的登录密码：</span><input type="password" class="memberPass" id="pass1"/></p><p class="modifyPass"><span>确认新的登录密码：</span><input type="password" class="memberPass" id="pass2"/></p></div><div class="bottom"><span class="btn2 popup_close2 popup_close22">取消</span><span class="btn1" id="passBtn">确认</span></div>')}),r.click(function(s){popup(n),s.stopPropagation();t.html('<div class="top">修改手机号码<span class="popup_close popup_close3"></span></div><div class="middle middle3"><p class="modifyPass"><span>当前手机号：</span><input type="text" class="memberPhone" id="oldPhone"/></p><p class="modifyPass"><span>新的手机号：</span><input type="text" class="memberPhone" id="newPhone"/></p></div><div class="bottom"><span class="btn2 popup_close2 popup_close33">取消</span><span class="btn1" id="phoneBtn">确认</span></div>')}),f.click(function(s){popup(n),s.stopPropagation();t.html('<div class="top">修改绑定邮箱<span class="popup_close popup_close4"></span></div><div class="middle"><p class="modifyName">新邮箱：<input type="text" class="memberEmail" id="email"/></p></div><div class="bottom"><span class="btn2 popup_close2 popup_close44">取消</span><span class="btn1" id="emailBtn">确认</span></div>')}),logout.click(function(s){popup(n),s.stopPropagation();t.html('<div class="top">注销提示：<span class="popup_close popup_close4"></span></div><div class="middle"><p class="modifyName">注销后所有数据将无法恢复，您确定要注销吗？</p></div><div class="bottom"><span class="btn2 popup_close2 popup_close44">取消</span><span class="btn1" id="layoutBtn">确认</span></div>')}),t.on("click",".popup_close",function(){n.fadeOut(),t.html("")}),t.on("click",".popup_close2",function(){n.fadeOut(),t.html("")}),t.click(function(s){s.stopPropagation()}),$(document).click(function(){n.fadeOut(),t.html("")}),t.on("click","#layoutBtn",function(){var s=DD_api.memberCancel;res=getAjax(s,{userToken:l}),"success"==res.flag?(n.fadeOut(),t.html(""),$.cookie("userName",null,{expires:-1,path:"/"}),$.cookie("userPhone",null,{expires:-1,path:"/"}),$.cookie("userToken",null,{expires:-1,path:"/"}),$.cookie("userPhoto",null,{expires:-1,path:"/"}),$.cookie("userTime",null,{expires:-1,path:"/"}),$.cookie("userEmail",null,{expires:-1,path:"/"}),$.cookie("goldTotal",null,{expires:-1,path:"/"}),Toast.init(),Toast.show(res.info,"success",null),setTimeout(function(){Toast.hide(),window.location.href="index.html"},3e3)):alert(res.info)}),t.on("click","#nameBtn",function(){var s=$(".memberName").val(),a=DD_api.updateMemberName,e=getAjax(a,{userToken:l,memberName:s});"success"==e.flag?(alert(e.info),$.cookie("userName",s,{expires:1,path:"/"}),window.location.reload(),n.fadeOut(),t.html("")):alert(e.info)}),t.on("click","#passBtn",function(){var s=$("#pass").val(),a=$("#pass1").val(),e=$("#pass2").val(),o=DD_api.updateMemberPassword,p=getAjax(o,{userToken:l,password:s,newPassword:a,rePassword:e});"success"==p.flag?(alert(p.info),n.fadeOut(),t.html("")):alert(p.info)}),t.on("click","#phoneBtn",function(){var s=$("#oldPhone").val(),a=$("#newPhone").val(),e=DD_api.updateMemberPhone,o=getAjax(e,{userToken:l,phone:s,newPhone:a});"success"==o.flag?($.cookie("userPhone",a,{expires:1,path:"/"}),alert(o.info),window.location.reload(),n.fadeOut(),t.html("")):alert(o.info)}),t.on("click","#emailBtn",function(){var s=$("#email").val(),a=DD_api.updateMemberEmail,e=getAjax(a,{userToken:l,email:s});"success"==e.flag?(alert(e.info),$.cookie("userEmail",s,{expires:1,path:"/"}),window.location.reload(),n.fadeOut(),t.html("")):alert(e.info)}),"普通会员"==s){p.html("普通会员");var h=a.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2");i.html(h),o.html("未设置").attr("class","no_1")}else{o.html("已设置").attr("class","yes_1");var v=a.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2");i.html(v),p.html(s)}if("null"==e)d.html("未设置").attr("class","no_1"),c.html("");else{d.html("已设置").attr("class","yes_1");var k=e.substr(0,3)+"****"+e.substr(7);c.html(k)}}else alert("请登录！")});